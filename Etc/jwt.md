# JWT
Json Web Token의 약자로 인증에 필요한 정보들을 암호화 시킨 JSON 토큰을 말한다. JWT 토큰을 HTTP Header에 심어서 서버가 클라이언트를 식별하는 방식이다.
JWT는 JSON 데이터를 Base64 URL-safe Encode 를 통해 인코딩하여 직렬화한 것이며, 토큰 내부에는 위변조 방지를 위해 개인키를 통한 전자서명도 들어있다.
따라서 사용자가 JWT 를 서버로 전송하면 서버는 서명을 검증하는 과정을 거치게 되며 검증이 완료되면 요청한 응답을 돌려준다.

# 구조
`.` 을 구분자를 통해 나눠지는 세 문자열의 조합이다. `,` 을 기준으로 왼쪽부터 Header, Payload, Signature를 의미한다.

### Header
```json
{
  "alg": "HS256",
  "typ": "JWT"
}
```

- alg : 서명 암호화 알고리즘이다.
- type : 토큰 유형을 나타낸다.

### Payload
```json
{
  "key": "value"
}
```

- 서버와 클라이언트가 주고받는 시스템에서 실제로 사용될 정보에 대한 내용이 `key: value` 로 들어있다.
- 정해진 타입은 없으나 대표적으로 Registered, Public, Private로 나뉜다.
  - Registered: 미리 정의 된 클레임이다.
    - iss(issuer, 발행자)
    - exp(expireation time, 만료 시간)
    - sub(subject, 제목)
    - iat(issued At, 발행 시간)
    - jti(JWI ID)
  - Public: 사용자가 정의할 수 있는 클레임 공개용 정보 전달을 위해 사용한다.
  - Private: 해당하는 당사자들 간에 정보를 공유하기 위해 만들어진 사용자 지정 클레임. 외부에 공개되도 상관없지만 해당 유저를 특정할 수 있는 정보를 담는다.

> 💡claim 은 key-value 형식으로 이루어진 한 쌍의 정보를 뜻한다.

### Signature
- 헤더와 페이로드, 서버가 갖고 있는 유일한 키 값을 합친 것을 헤더에서 정의한 알고리즘으로 암호화를 한다.

# 사용 용도
### 권한 부여
사용자가 로그인하면 각 후속 요청에는 JWT가 포함되어 사용자가 해당 토큰으로 허용되는 경로, 서비스 및 리소스에 액세스할 수 있다.
하나의 서명은 오버헤드가 적고 여러 도메인에서 쉽게 사용할 수 있기 때문에 자주 사용된다.

### 정보 교환
예를 들어 공개/개인 키 쌍을 사용하여 JWT에 서명할 수 있기 때문에 발신자가 누구인지 확인할 수 있다.
또한 헤더와 페이로드를 사용하여 서명을 계산하므로 콘텐츠가 변조되지 않았는지 확인할 수도 있다.

# 동작 방식
1. 사용자가 ID, PW를 입력하여 서버에 로그인 인증을 요청한다.
2. 서버에서 클라이언트로부터 인증 요청을 받으면 Header, PayLoad, Signature를 정의한다.
3. Hedaer, PayLoad, Signature를 각각 Base64로 한 번 더 암호화하여 JWT를 생성하고 이를 쿠키에 담아 클라이언트에게 발급한다.
4. 클라이언트는 서버로부터 받은 JWT를 로컬 스토리지에 저장한다. (쿠키나 로컬/세션 스토리지, http 쿠키 등 다른 곳에 저장할 수도 있음)
5. API를 서버에 요청할때 Authorization header에 Access Token을 담아서 보낸다.
6. 서버가 할 일은 클라이언트가 Header에 담아서 보낸 JWT가 내 서버에서 발행한 토큰인지 일치 여부를 확인하여 일치한다면 인증을 통과시켜주고 아니라면 통과시키지 않으면 된다.
7. 인증이 통과되었으므로 페이로드에 들어있는 유저의 정보들을 선택해서 클라이언트에 돌려준다.
8. 클라이언트가 서버에 요청을 했는데 액세스 토큰의 시간이 만료되면 클라이언트는 리프래시 토큰을 이용해서 서버로부터 새로운 엑세스 토큰을 발급 받는다.

# 장점
1. Header와 Payload를 가지고 Signature를 생성하므로 데이터 위변조를 막을 수 있다.
2. 인증 정보에 대한 별도의 저장소가 필요 없다.
3. JWT는 토큰에 대한 기본 정보와 전달할 정보 및 토큰 검증을 증명하는 서명 등 필요한 모든 정보를 자체적으로 지니고 있다.
4. 확장성이 우수하다.
5. 토큰 기반으로 다른 로그인 시스템에 접근 및 권한 공유가 가능하다.
6. OAuth의 경우 Facebook, Google 등 소셜 계정을 이용하여 다른 웹서비스에서도 로그인을 할 수 있다.

---

[^1] https://jwt.io/introduction
